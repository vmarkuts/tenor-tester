<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Tenor GIF & Stickers</title>
  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      margin: 20px;
      background: #111;
      color: #eee;
    }
    h1 {
      margin-bottom: 10px;
    }
    form {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      align-items: center;
      margin-bottom: 15px;
    }
    input[type="text"],
    input[type="number"] {
      padding: 6px 8px;
      min-width: 160px;
    }
    select, button, label {
      padding: 6px 8px;
    }
    button {
      cursor: pointer;
    }
    #results {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
      gap: 10px;
      margin-top: 10px;
    }
    .item {
      background: #1f1f1f;
      border-radius: 8px;
      padding: 4px;
      overflow: hidden;
      display: flex;
      justify-content: center;
      align-items: center;
    }
    .item img {
      max-width: 100%;
      border-radius: 4px;
      display: block;
    }
    #status {
      margin-top: 5px;
      font-size: 0.9em;
      opacity: 0.8;
    }
  </style>
</head>
<body>
  <h1>Tenor GIF/Sticker Tester</h1>

  <form id="search-form">
    <input
      type="text"
      id="query"
      placeholder="Search term (e.g. cat, happy, meme)"
      required
    />

    <label>
      Content filter:
      <select id="contentfilter">
        <option value="off">off (no filter)</option>
        <option value="low">low</option>
        <option value="medium">medium</option>
        <option value="high">high</option>
      </select>
    </label>

    <label>
      Per page:
      <input
        type="number"
        id="limit"
        value="24"
        min="1"
        max="100"
      />
    </label>

    <label>
      <input type="checkbox" id="stickers" />
      Stickers instead of GIFs
    </label>

    <button type="submit">Search</button>
  </form>

  <div id="status"></div>
  <div id="results"></div>

  <script>
    const API_KEY = "AIzaSyBoo9EeD_G4fPLYdHJ_2z7DsbCto-pe4Zc";
    const CLIENT_KEY = "tenor-vlad-test-app"; 
    const BASE_URL = "https://tenor.googleapis.com/v2/search";

    const form = document.getElementById("search-form");
    const resultsEl = document.getElementById("results");
    const statusEl = document.getElementById("status");

    form.addEventListener("submit", async (event) => {
      event.preventDefault();

      const q = document.getElementById("query").value.trim();
      const contentfilter = document.getElementById("contentfilter").value;
      const stickersOnly = document.getElementById("stickers").checked;
      const limitInput = document.getElementById("limit").value;

      if (!q) return;

      // –Ω–æ—Ä–º–∞–ª—ñ–∑—É—î–º–æ –ª—ñ–º—ñ—Ç
      let limit = parseInt(limitInput, 10);
      if (Number.isNaN(limit)) {
        limit = 24;
      }
      if (limit < 1) limit = 1;
      if (limit > 50) limit = 50; // Tenor –Ω–µ –ª—é–±–∏—Ç—å –¥—É–∂–µ –≤–µ–ª–∏–∫—ñ –∑–Ω–∞—á–µ–Ω–Ω—è

      resultsEl.innerHTML = "";
      statusEl.textContent = `Loading... (limit=${limit})`;

      const params = new URLSearchParams({
        key: API_KEY,
        client_key: CLIENT_KEY,
        q,
        limit: String(limit),
        contentfilter,
        media_filter: "minimal"
      });

      if (stickersOnly) {
        params.set("searchfilter", "sticker");
      }

      const url = `${BASE_URL}?${params.toString()}`;

      try {
        const resp = await fetch(url);
        if (!resp.ok) {
          throw new Error(`HTTP ${resp.status}`);
        }

        const data = await resp.json();

        console.log("Tenor response:", data);

        if (!data.results || data.results.length === 0) {
          statusEl.textContent = "No results ü•≤";
          return;
        }

        statusEl.textContent = `Found ${data.results.length} items (limit=${limit})`;

        data.results.forEach((item) => {
          const mf = item.media_formats || {};
          const candidate =
            mf.tinygif ||
            mf.gif ||
            mf.mediumgif ||
            mf.nanogif ||
            mf.preview ||
            null;

          if (!candidate || !candidate.url) return;

          const div = document.createElement("div");
          div.className = "item";

          const img = document.createElement("img");
          img.src = candidate.url;
          img.alt = item.content_description || q;

          div.appendChild(img);
          resultsEl.appendChild(div);
        });
      } catch (err) {
        console.error(err);
        statusEl.textContent = "Error: " + err.message;
      }
    });
  </script>
</body>
</html>
